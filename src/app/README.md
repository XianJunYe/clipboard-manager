# 剪贴板管理器 - 模块化架构说明

## 📁 目录结构

```
src/app/
├── config/           # 配置管理
│   └── AppConfig.js  # 应用配置
├── managers/         # 主要管理器
│   └── ClipboardManager.js  # 剪贴板管理器主类
├── services/         # 业务服务
│   ├── TrayService.js        # 托盘服务
│   ├── ShortcutService.js    # 快捷键服务
│   ├── ClipboardWatcher.js   # 剪贴板监控服务
│   └── NotificationService.js # 通知服务
├── utils/            # 工具类
│   └── Logger.js     # 日志管理器
└── windows/          # 窗口管理（待完善）
    ├── QuickSelectWindow.js
    └── DetailWindow.js
```

## 🎯 架构优势

### 1. **模块化设计**
- 每个功能独立为一个服务类
- 降低耦合度，提高可维护性
- 便于单元测试和功能扩展

### 2. **统一日志管理**
- 支持不同日志级别（DEBUG, INFO, WARN, ERROR）
- 开发/生产环境自动切换
- 统一的日志格式和输出

### 3. **配置集中管理**
- 所有配置项集中在 `AppConfig.js`
- 支持动态配置修改
- 便于环境切换和参数调优

### 4. **性能优化**
- 智能剪贴板监控频率调整
- 减少不必要的系统调用
- 优化内存使用

### 5. **错误处理增强**
- 全局异常捕获
- 用户友好的错误通知
- 详细的错误日志记录

## 🔧 主要组件说明

### ClipboardManager
- **职责**: 总体协调各个服务
- **功能**: 窗口管理、数据存储、业务逻辑协调
- **优化**: 从841行代码减少到约400行

### TrayService
- **职责**: 系统托盘管理
- **功能**: 托盘图标创建、菜单管理、事件处理
- **优化**: 独立的图标加载逻辑和错误处理

### ShortcutService
- **职责**: 全局快捷键管理
- **功能**: 快捷键注册/注销、冲突检测
- **优化**: 统一的快捷键生命周期管理

### ClipboardWatcher
- **职责**: 剪贴板内容监控
- **功能**: 智能监控频率、内容变化检测
- **优化**: 动态调整检查间隔，降低CPU使用

### NotificationService
- **职责**: 系统通知管理
- **功能**: 各类通知显示、事件处理
- **优化**: 统一的通知配置和错误处理

### Logger
- **职责**: 日志输出管理
- **功能**: 分级日志、格式化输出
- **优化**: 替换70+个散乱的console.log

### AppConfig
- **职责**: 应用配置管理
- **功能**: 配置项集中管理、动态获取/设置
- **优化**: 消除硬编码配置，便于维护

## 📊 优化效果

| 指标 | 优化前 | 优化后 | 改进 |
|------|--------|--------|------|
| main.js 行数 | 841 | 120 | -86% |
| 模块数量 | 1 | 7 | +600% |
| 日志管理 | 散乱 | 统一 | ✅ |
| 配置管理 | 硬编码 | 集中管理 | ✅ |
| 错误处理 | 基础 | 完善 | ✅ |
| 可测试性 | 困难 | 简单 | ✅ |

## 🚀 使用方式

### 开发环境
```bash
# 设置开发模式（会显示DEBUG日志）
NODE_ENV=development npm start
```

### 生产环境
```bash
# 正常启动（只显示INFO及以上级别日志）
npm start
```

### 配置修改
```javascript
// 修改配置示例
const { AppConfig } = require('./app/config/AppConfig');

// 修改剪贴板检查间隔
AppConfig.set('clipboard.checkInterval', 300);

// 修改最大历史记录数
AppConfig.set('clipboard.maxHistory', 100);
```

## 🔮 后续优化计划

1. **完善窗口管理模块**
2. **添加单元测试**
3. **实现详细窗口重构**
4. **添加用户设置界面**
5. **实现自动更新服务重构**

## 📝 注意事项

- 原始的 `main.js` 已备份为 `main-original.js`
- 如需回滚，只需替换 `main.js` 文件
- 新架构保持了所有原有功能
- 配置文件可根据需要调整参数 